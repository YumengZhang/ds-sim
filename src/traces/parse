MIN_NODES=50

cat LA-UR-05-7318-failure-data-1996-2005.csv | tr '/' ' '|tr ':' ' ' | gawk -F',' '{ cluster=$1;nodes=$3; node=$7;  split($17,k," "); start=mktime(sprintf("%d %d %d %d %d 00 ",k[3],k[1],k[2],k[4],k[5])) ;  split($18,k," "); end=mktime(sprintf("%d %d %d %d %d 00 ",k[3],k[1],k[2],k[4],k[5])) ; outage=$19; reason=sprintf("%s %s %s %s %s %s",$20,$21,$22,$23,$24,$25); res=0;match(reason,"Disk");  if (RLENGTH>0) res++; match(reason,"Raid");  if (RLENGTH>0) res++;  match(reason,"IDE");  if (RLENGTH>0) res++;match(reason,"SCSI");  if (RLENGTH>0) res++;match(reason,"Unresolvable");  if (RLENGTH>0) res++; if (res>0) {actual="permanent";} else {actual="transient";};   print cluster","nodes","node","start","end","outage","actual;}' | uniq  | awk -F',' "{if (\$2>$MIN_NODES) print \$0>>\$1; }"
